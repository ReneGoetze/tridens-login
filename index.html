<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>TRIDENS – Secure Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  html,body{
    margin:0;
    background:#000;
    height:100%;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }

  .stage{
    position:relative;
    width:min(520px,95vw);
    aspect-ratio:1290/1919;
    margin:4vh auto;
    overflow:hidden;
    border-radius:18px;
    box-shadow:0 30px 90px rgba(0,0,0,.7);
    background:#000;
  }

  .layer{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    opacity:0;
    transition:opacity .85s ease;
  }
  .layer.on{ opacity:1; }

  /* "Dissolve/Glow" beim Ausblenden von LOGIN (Annäherung) */
  @keyframes dissolveOut {
    0%   { filter: blur(0px) brightness(1) contrast(1) drop-shadow(0 0 0 rgba(0,229,255,0)); transform: scale(1); opacity:1; }
    40%  { filter: blur(1px) brightness(1.05) contrast(1.05) drop-shadow(0 0 14px rgba(0,229,255,.28)); transform: scale(1.005); opacity:1; }
    100% { filter: blur(6px) brightness(1.15) contrast(1.15) drop-shadow(0 0 28px rgba(0,229,255,.45)); transform: scale(1.02); opacity:0; }
  }
  .dissolve{
    animation: dissolveOut .85s ease forwards;
    will-change: filter, transform, opacity;
  }

  /* Code UI */
  #codeUI{
    position:absolute;
    inset:0;
    pointer-events:none;
  }
  #codeUI.on{ pointer-events:auto; }

  .code-row{
    position:absolute;
    top:45.6%;
    left:7%;
    width:86%;
    display:flex;
    justify-content:space-between;
  }

  .code-row input{
    width:12%;
    height:70px;
    background:transparent;
    border:none;
    font-size:34px;
    text-align:center;
    font-weight:700;
    color:#0b2a33;
    outline:none;
    caret-color:#00e5ff;
  }

  /* Hinweistext – erst anzeigen, wenn CODE.jpg da ist */
  .hint{
    position:absolute;
    top:54%;
    width:100%;
    text-align:center;
    color:#fff;
    font-size:16px;
    opacity:0;
    transition:opacity .35s ease;
    text-shadow:0 2px 12px rgba(0,0,0,.55);
  }
  .hint.on{ opacity:1; }

  /* Futuristischer Countdown */
  #countdown{
    position:absolute;
    top:39.2%;
    left:50%;
    transform:translateX(-50%);
    min-width:140px;
    text-align:center;
    font-weight:800;
    font-size:34px;
    letter-spacing:.18em;
    color:#c9f2ff;
    opacity:0;
    transition:opacity .25s ease;
    text-shadow:
      0 0 10px rgba(0,229,255,.35),
      0 0 22px rgba(0,229,255,.18),
      0 2px 14px rgba(0,0,0,.55);
    filter: drop-shadow(0 0 18px rgba(0,229,255,.14));
    user-select:none;
    pointer-events:none;
  }
  #countdown.on{ opacity:1; }

  .countPulse{
    animation: pulse .95s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform:translateX(-50%) scale(1); opacity:1; }
    50%{ transform:translateX(-50%) scale(1.05); opacity:.92; }
  }

  /* Denied Text */
  .denied{
    position:absolute;
    bottom:18px;
    width:100%;
    text-align:center;
    font-size:20px;
    font-weight:800;
    color:#fff;
    opacity:0;
    text-shadow:0 2px 14px rgba(0,0,0,.75);
  }
  .denied.on{ opacity:1; }
</style>
</head>

<body>

<div class="stage">

  <!-- Videos: bewusst stumm für sofortigen Autostart -->
  <video id="login" class="layer" muted playsinline preload="auto">
    <source src="LOGIN.MP4" type="video/mp4">
  </video>

  <video id="server" class="layer" muted playsinline preload="auto">
    <source src="SERVER.MP4" type="video/mp4">
  </video>

  <video id="deniedVid" class="layer" muted playsinline preload="auto">
    <source src="DENIED.MP4" type="video/mp4">
  </video>

  <img id="codeImg" class="layer" src="CODE.jpg" alt="Code Eingabe">

  <div id="codeUI">
    <div id="countdown">15</div>

    <div class="code-row">
      <input maxlength="1"><input maxlength="1"><input maxlength="1">
      <input maxlength="1"><input maxlength="1"><input maxlength="1"><input maxlength="1">
    </div>

    <div id="hint" class="hint">Bitte geben Sie den Zugangscode ein.</div>
  </div>

  <div id="deniedText" class="denied">Zugang verweigert</div>
</div>

<script>
  // Nach Ende von DENIED.MP4 -> 3 Sekunden später Redirect
  const CALENDLY_URL = "https://calendly.com/r-goetze-tridensausgeführt";

  const login = document.getElementById('login');
  const server = document.getElementById('server');
  const denied = document.getElementById('deniedVid');

  const codeImg = document.getElementById('codeImg');
  const codeUI = document.getElementById('codeUI');
  const hint = document.getElementById('hint');
  const countdownEl = document.getElementById('countdown');

  const deniedText = document.getElementById('deniedText');
  const inputs = document.querySelectorAll('.code-row input');

  let countdownTimer = null;
  let secondsLeft = 15;
  let progressed = false;

  // Übergang: SERVER startet kurz vor Ende LOGIN
  let transitioned = false;
  const OVERLAP_SEC = 0.8;

  function show(el){ el.classList.add('on'); }
  function hide(el){ el.classList.remove('on'); }

  function clearInputs(){ inputs.forEach(i => i.value = ""); }

  function blurAll(){
    inputs.forEach(i => i.blur());
    if (document.activeElement && typeof document.activeElement.blur === "function") {
      document.activeElement.blur();
    }
  }

  function stopCountdown(){
    if (countdownTimer) clearInterval(countdownTimer);
    countdownTimer = null;
  }

  function startCountdown(){
    stopCountdown();
    secondsLeft = 15;
    countdownEl.textContent = String(secondsLeft).padStart(2,'0');
    countdownEl.classList.add('on','countPulse');

    countdownTimer = setInterval(() => {
      secondsLeft--;
      countdownEl.textContent = String(Math.max(secondsLeft,0)).padStart(2,'0');
      if (secondsLeft <= 0){
        stopCountdown();
        proceedToDenied();
      }
    }, 1000);
  }

  function proceedToCode(){
    hide(server);
    show(codeImg);

    codeUI.classList.add('on');
    hint.classList.add('on');
    startCountdown();

    setTimeout(() => inputs[0].focus(), 60);
  }

  function proceedToDenied(){
    if (progressed) return;
    progressed = true;

    stopCountdown();
    countdownEl.classList.remove('on','countPulse');
    hint.classList.remove('on');

    // Tastatur weg + Felder leeren
    blurAll();
    clearInputs();

    // UI deaktivieren
    codeUI.classList.remove('on');

    // Bild weg, denied an
    hide(codeImg);
    show(denied);
    try { denied.play(); } catch(e) {}

    deniedText.classList.add('on');

    denied.onended = () => {
      setTimeout(() => {
        window.location.href = CALENDLY_URL;
      }, 3000);
    };
  }

  async function doTransitionToServer(){
    if (transitioned) return;
    transitioned = true;

    // SERVER sichtbar + starten (stumm, damit es überall sicher läuft)
    show(server);
    try { await server.play(); } catch(e) {}

    // LOGIN "auflösen"
    login.classList.add('dissolve');
    setTimeout(() => hide(login), 900);

    server.onended = () => proceedToCode();

    // Fallback: falls onended mal nicht feuert
    if (isFinite(server.duration) && server.duration > 0){
      setTimeout(() => {
        if (!progressed && !codeImg.classList.contains('on') && !denied.classList.contains('on')) {
          proceedToCode();
        }
      }, Math.ceil(server.duration * 1000) + 300);
    }
  }

  function attachSmoothTrigger(){
    transitioned = false;

    const onTime = () => {
      if (!isFinite(login.duration) || login.duration <= 0) return;
      const remaining = login.duration - login.currentTime;
      if (remaining <= OVERLAP_SEC){
        login.removeEventListener('timeupdate', onTime);
        doTransitionToServer();
      }
    };

    login.addEventListener('timeupdate', onTime);

    login.onended = () => {
      login.removeEventListener('timeupdate', onTime);
      doTransitionToServer();
    };
  }

  // Input Verhalten: 1 Zeichen, auto-advance, Enter -> denied
  inputs.forEach((i, idx) => {
    i.addEventListener('input', () => {
      if (!i.value) return;
      i.value = i.value.slice(-1);
      if (inputs[idx+1]) inputs[idx+1].focus();
    });

    i.addEventListener('keydown', (e) => {
      if (e.key === "Enter"){
        e.preventDefault();
        proceedToDenied();
      }
    });
  });

  // ===== AUTOSTART (stumm) =====
  function resetAll(){
    progressed = false;
    transitioned = false;

    // alles aus
    hide(server); hide(denied); hide(codeImg);
    codeUI.classList.remove('on');
    hint.classList.remove('on');
    deniedText.classList.remove('on');
    countdownEl.classList.remove('on','countPulse');
    stopCountdown();
    clearInputs();
    blurAll();

    // videos reset
    [login, server, denied].forEach(v => {
      try { v.pause(); v.currentTime = 0; } catch(e) {}
    });
    login.classList.remove('dissolve');
  }

  (async function start(){
    resetAll();

    show(login);
    try { await login.play(); } catch(e) {}

    attachSmoothTrigger();
  })();
</script>

</body>
</html>
