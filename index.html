<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>TRIDENS – Secure Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  html,body{
    margin:0;
    background:#000;
    height:100%;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }

  .stage{
    position:relative;
    width:min(520px,95vw);
    aspect-ratio:1290/1919;
    margin:4vh auto;
    overflow:hidden;
    border-radius:18px;
    box-shadow:0 30px 90px rgba(0,0,0,.7);
    background:#000;
  }

  .layer{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    opacity:0;
    transition:opacity .85s ease;
  }
  .layer.on{ opacity:1; }

  /* ===== Übergangseffekt: "Dissolve/Glow" beim Ausblenden (Annäherung) ===== */
  @keyframes dissolveOut {
    0%   { filter: blur(0px) brightness(1) contrast(1) drop-shadow(0 0 0 rgba(0,229,255,0)); transform: scale(1); opacity:1; }
    40%  { filter: blur(1px) brightness(1.05) contrast(1.05) drop-shadow(0 0 14px rgba(0,229,255,.28)); transform: scale(1.005); opacity:1; }
    100% { filter: blur(6px) brightness(1.15) contrast(1.15) drop-shadow(0 0 28px rgba(0,229,255,.45)); transform: scale(1.02); opacity:0; }
  }
  .dissolve{
    animation: dissolveOut .85s ease forwards;
    will-change: filter, transform, opacity;
  }

  /* ===== Start-Overlay (für Sound-Freigabe) ===== */
  #startBtn{
    position:absolute; inset:0; width:100%; height:100%;
    background:rgba(0,0,0,.35);
    border:0; color:#fff;
    font-size:18px; letter-spacing:.10em;
    cursor:pointer; z-index:50;
    text-shadow:0 0 18px rgba(0,229,255,.25);
  }

  /* ===== Code UI ===== */
  #codeUI{
    position:absolute;
    inset:0;
    pointer-events:none;
  }
  #codeUI.on{ pointer-events:auto; }

  .code-row{
    position:absolute;
    top:45.6%;
    left:7%;
    width:86%;
    display:flex;
    justify-content:space-between;
  }

  .code-row input{
    width:12%;
    height:70px;
    background:transparent;
    border:none;
    font-size:34px;
    text-align:center;
    font-weight:700;
    color:#0b2a33;
    outline:none;
    caret-color:#00e5ff;
  }

  /* Hinweistext – erst anzeigen, wenn CODE.jpg da ist */
  .hint{
    position:absolute;
    top:54%;
    width:100%;
    text-align:center;
    color:#fff;
    font-size:16px;
    opacity:0;
    transition:opacity .35s ease;
    text-shadow:0 2px 12px rgba(0,0,0,.55);
  }
  .hint.on{ opacity:1; }

  /* ===== Futuristischer Countdown ===== */
  #countdown{
    position:absolute;
    top:39.2%;
    left:50%;
    transform:translateX(-50%);
    min-width:140px;
    text-align:center;
    font-weight:800;
    font-size:34px;
    letter-spacing:.18em;
    color:#c9f2ff;
    opacity:0;
    transition:opacity .25s ease;
    text-shadow:
      0 0 10px rgba(0,229,255,.35),
      0 0 22px rgba(0,229,255,.18),
      0 2px 14px rgba(0,0,0,.55);
    filter: drop-shadow(0 0 18px rgba(0,229,255,.14));
    user-select:none;
    pointer-events:none;
  }
  #countdown.on{ opacity:1; }
  .countPulse{
    animation: pulse .95s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform:translateX(-50%) scale(1); opacity:1; }
    50%{ transform:translateX(-50%) scale(1.05); opacity:.92; }
  }

  /* ===== Denied Text ===== */
  .denied{
    position:absolute;
    bottom:18px;
    width:100%;
    text-align:center;
    font-size:20px;
    font-weight:800;
    color:#fff;
    opacity:0;
  }
  .denied.on{ opacity:1; }
</style>
</head>

<body>

<div class="stage">
  <button id="startBtn">KLICKEN, UM ZU STARTEN</button>

  <video id="login" class="layer" playsinline preload="auto">
    <source src="LOGIN.MP4" type="video/mp4">
  </video>

  <video id="server" class="layer" playsinline preload="auto">
    <source src="SERVER.MP4" type="video/mp4">
  </video>

  <video id="deniedVid" class="layer" playsinline preload="auto">
    <source src="DENIED.MP4" type="video/mp4">
  </video>

  <img id="codeImg" class="layer" src="CODE.jpg" alt="Code Eingabe">

  <div id="codeUI">
    <div id="countdown">15</div>

    <div class="code-row">
      <input maxlength="1"><input maxlength="1"><input maxlength="1">
      <input maxlength="1"><input maxlength="1"><input maxlength="1"><input maxlength="1">
    </div>

    <div id="hint" class="hint">Bitte geben Sie den Zugangscode ein.</div>
  </div>

  <div id="deniedText" class="denied">Zugang verweigert</div>
</div>

<script>
  const CALENDLY_URL = "https://calendly.com/r-goetze-tridensausgeführt";

  const startBtn = document.getElementById('startBtn');

  const login = document.getElementById('login');
  const server = document.getElementById('server');
  const denied = document.getElementById('deniedVid');

  const codeImg = document.getElementById('codeImg');
  const codeUI = document.getElementById('codeUI');
  const hint = document.getElementById('hint');
  const countdownEl = document.getElementById('countdown');

  const deniedText = document.getElementById('deniedText');
  const inputs = document.querySelectorAll('.code-row input');

  let countdownTimer = null;
  let secondsLeft = 15;
  let progressed = false; // verhindert doppeltes Triggern

  function show(el){ el.classList.add('on'); }
  function hide(el){ el.classList.remove('on'); }

  function clearInputs(){
    inputs.forEach(i => i.value = "");
  }

  function blurAll(){
    // Mobile-Tastatur schließen
    inputs.forEach(i => i.blur());
    document.activeElement?.blur?.();
  }

  async function playWithSound(video){
    video.muted = false;
    video.volume = 1.0;
    try { await video.play(); } catch(e) {}
  }

  function stopCountdown(){
    if (countdownTimer) clearInterval(countdownTimer);
    countdownTimer = null;
  }

  function startCountdown(){
    stopCountdown();
    secondsLeft = 15;
    countdownEl.textContent = String(secondsLeft).padStart(2,'0');
    countdownEl.classList.add('on','countPulse');

    countdownTimer = setInterval(() => {
      secondsLeft--;
      countdownEl.textContent = String(Math.max(secondsLeft,0)).padStart(2,'0');

      // Wenn abgelaufen: genauso wie Enter weitergehen
      if (secondsLeft <= 0){
        stopCountdown();
        proceedToDenied();
      }
    }, 1000);
  }

  function proceedToCode(){
    hide(server);
    show(codeImg);

    codeUI.classList.add('on');
    hint.classList.add('on');
    startCountdown();

    // Fokus auf erstes Feld
    setTimeout(() => inputs[0].focus(), 60);
  }

  function proceedToDenied(){
    if (progressed) return;
    progressed = true;

    stopCountdown();
    countdownEl.classList.remove('on','countPulse');
    hint.classList.remove('on');

    // Tastatur weg + Felder leeren
    blurAll();
    clearInputs();

    // UI deaktivieren
    codeUI.classList.remove('on');

    // Bild weg, denied an
    hide(codeImg);
    show(denied);
    playWithSound(denied);

    deniedText.classList.add('on');

    // Nach Video-Ende + 3s weiterleiten
    denied.onended = () => {
      setTimeout(() => {
        window.location.href = CALENDLY_URL;
      }, 3000);
    };
  }

  // ===== Übergang LOGIN -> SERVER flüssiger: Overlap + dissolve =====
  function scheduleSmoothTransition(){
    // starte server kurz vor Ende des login-videos
    const overlap = 0.75; // Sekunden Überlappung
    const d = login.duration;

    // Fallback, falls duration nicht sauber da ist
    if (!isFinite(d) || d <= overlap + 0.1){
      login.onended = () => startServerNow();
      return;
    }

    const ms = Math.max(0, (d - overlap) * 1000);
    setTimeout(() => {
      // Nur wenn LOGIN noch läuft
      if (!login.paused && !login.ended) startServerNow();
    }, ms);

    // Zusätzlich falls irgendwas nicht triggert:
    login.onended = () => {
      if (server.classList.contains('on')) return;
      startServerNow();
    };
  }

  async function startServerNow(){
    show(server);
    await playWithSound(server);

    // LOGIN "auflösen" (Annäherung)
    login.classList.add('dissolve');

    // sicherheitshalber nach Ende der Dissolve-Animation ausblenden
    setTimeout(() => hide(login), 900);

    server.onended = () => proceedToCode();
  }

  // ===== Input Verhalten =====
  inputs.forEach((i, idx) => {
    i.addEventListener('input', () => {
      if (!i.value) return;
      i.value = i.value.slice(-1); // nur 1 Zeichen
      if (inputs[idx+1]) inputs[idx+1].focus();
    });

    i.addEventListener('keydown', (e) => {
      if (e.key === "Enter"){
        e.preventDefault();
        proceedToDenied();
      }
    });
  });

  // ===== Start (für Sound) =====
  startBtn.addEventListener('click', async () => {
    startBtn.style.display = 'none';

    progressed = false;
    hide(server); hide(denied); hide(codeImg);
    codeUI.classList.remove('on');
    hint.classList.remove('on');
    deniedText.classList.remove('on');
    countdownEl.classList.remove('on','countPulse');
    stopCountdown();
    clearInputs();

    show(login);
    await playWithSound(login);

    // Smooth transition vorbereiten
    login.onloadedmetadata = scheduleSmoothTransition;
    // falls metadata schon da ist:
    if (isFinite(login.duration) && login.duration > 0) scheduleSmoothTransition();
  }, { passive:true });
</script>

</body>
</html>
