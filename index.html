<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>TRIDENS – Secure Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  html,body{
    margin:0;
    background:#000;
    height:100%;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }

  .stage{
    position:relative;
    width:min(520px,95vw);
    aspect-ratio:1290/1919;
    margin:4vh auto;
    overflow:hidden;
    border-radius:18px;
    box-shadow:0 30px 90px rgba(0,0,0,.7);
    background:#000;
  }

  .layer{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    opacity:0;
    transition:opacity .85s ease;
  }
  .layer.on{ opacity:1; }

  /* "Dissolve/Glow" beim Ausblenden von LOGIN (Annäherung) */
  @keyframes dissolveOut {
    0%   { filter: blur(0px) brightness(1) contrast(1) drop-shadow(0 0 0 rgba(0,229,255,0)); transform: scale(1); opacity:1; }
    40%  { filter: blur(1px) brightness(1.05) contrast(1.05) drop-shadow(0 0 14px rgba(0,229,255,.28)); transform: scale(1.005); opacity:1; }
    100% { filter: blur(6px) brightness(1.15) contrast(1.15) drop-shadow(0 0 28px rgba(0,229,255,.45)); transform: scale(1.02); opacity:0; }
  }
  .dissolve{
    animation: dissolveOut .85s ease forwards;
    will-change: filter, transform, opacity;
  }

  /* Code UI */
  #codeUI{
    position:absolute;
    inset:0;
    pointer-events:none;
  }
  #codeUI.on{ pointer-events:auto; }

  .code-row{
    position:absolute;
    top:45.6%;
    left:7%;
    width:86%;
    display:flex;
    justify-content:space-between;
  }

  .code-row input{
    width:12%;
    height:70px;
    background:transparent;
    border:none;
    font-size:34px;
    text-align:center;
    font-weight:700;
    color:#0b2a33;
    outline:none;
    caret-color:#00e5ff;
  }

  /* Hinweistext – erst anzeigen, wenn CODE.jpg da ist */
  .hint{
    position:absolute;
    top:54%;
    width:100%;
    text-align:center;
    color:#fff;
    font-size:16px;
    opacity:0;
    transition:opacity .35s ease;
    text-shadow:0 2px 12px rgba(0,0,0,.55);
  }
  .hint.on{ opacity:1; }

  /* ===== Futuristischer Countdown (Glas + Scanlines + Neon) =====
     - steht unter dem Hint
     - minimal nach rechts verschoben, damit optisch mittig im Bild wirkt
  */
  #countdownWrap{
    position:absolute;
    top:58.3%;              /* Abstand unter der Eingabeaufforderung */
    left:50.65%;            /* winzig weiter rechts */
    transform:translateX(-50%);
    opacity:0;
    transition:opacity .25s ease;
    pointer-events:none;
    user-select:none;
  }
  #countdownWrap.on{ opacity:1; }

  #countdownGlass{
    position:relative;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    min-width:160px;
    height:54px;
    padding:0 18px;
    border-radius:14px;
    background:rgba(0,0,0,.28);
    border:1px solid rgba(140,235,255,.32);
    box-shadow:
      0 0 18px rgba(0,229,255,.10),
      inset 0 0 18px rgba(0,229,255,.08);
    backdrop-filter: blur(6px);
  }

  /* Scanlines */
  #countdownGlass::before{
    content:"";
    position:absolute;
    inset:8px 10px;
    border-radius:10px;
    background:repeating-linear-gradient(
      to bottom,
      rgba(0,229,255,.10) 0px,
      rgba(0,229,255,.10) 1px,
      rgba(0,0,0,0) 3px,
      rgba(0,0,0,0) 6px
    );
    opacity:.22;
    mix-blend-mode:screen;
    pointer-events:none;
  }

  /* kleine Ecken/Tech-Details */
  #countdownGlass::after{
    content:"";
    position:absolute;
    inset:-1px;
    border-radius:14px;
    background:linear-gradient(120deg, rgba(0,229,255,.22), rgba(0,0,0,0), rgba(0,229,255,.18));
    opacity:.35;
    pointer-events:none;
  }

  #countdown{
    position:relative;
    z-index:1;
    font-size:34px;
    font-weight:900;
    letter-spacing:.22em;
    /* "futuristische" Anmutung über Mono/Tech-Fonts (falls vorhanden), sonst fallback */
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
                 "Share Tech Mono","Orbitron","Rajdhani","Oxanium", monospace;
    color:#c9f2ff;
    text-shadow:
      0 0 10px rgba(0,229,255,.35),
      0 0 22px rgba(0,229,255,.18),
      0 2px 14px rgba(0,0,0,.55);
    filter: drop-shadow(0 0 18px rgba(0,229,255,.14));
  }

  .countPulse{
    animation: pulse .95s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform:translateX(-50%) scale(1); }
    50%{ transform:translateX(-50%) scale(1.04); }
  }

  /* Denied Text */
  .denied{
    position:absolute;
    bottom:18px;
    width:100%;
    text-align:center;
    font-size:20px;
    font-weight:800;
    color:#fff;
    opacity:0;
    text-shadow:0 2px 14px rgba(0,0,0,.75);
  }
  .denied.on{ opacity:1; }
</style>
</head>

<body>

<div class="stage">

  <!-- Videos: stumm für sofortigen Autostart -->
  <video id="login" class="layer" muted playsinline preload="auto">
    <source src="LOGIN.MP4" type="video/mp4">
  </video>

  <video id="server" class="layer" muted playsinline preload="auto">
    <source src="SERVER.MP4" type="video/mp4">
  </video>

  <video id="deniedVid" class="layer" muted playsinline preload="auto">
    <source src="DENIED.MP4" type="video/mp4">
  </video>

  <img id="codeImg" class="layer" src="CODE.jpg" alt="Code Eingabe">

  <div id="codeUI">
    <div class="code-row">
      <input maxlength="1"><input maxlength="1"><input maxlength="1">
      <input maxlength="1"><input maxlength="1"><input maxlength="1"><input maxlength="1">
    </div>

    <div id="hint" class="hint">Bitte geben Sie den Zugangscode ein.</div>

    <!-- Futuristischer Countdown unter der Aufforderung -->
    <div id="countdownWrap">
      <div id="countdownGlass">
        <div id="countdown">15</div>
      </div>
    </div>
  </div>

  <div id="deniedText" class="denied">Zugang verweigert</div>
</div>

<script>
  // Redirect (robust): nach Ende von DENIED.MP4 + 3 Sekunden
  // Hinweis: die URL enthält "ü" -> sicherheitshalber korrekt encoden
  const CALENDLY_URL_RAW = "https://calendly.com/r-goetze-tridensausgeführt";
  const CALENDLY_URL = encodeURI(CALENDLY_URL_RAW);

  const login = document.getElementById('login');
  const server = document.getElementById('server');
  const denied = document.getElementById('deniedVid');

  const codeImg = document.getElementById('codeImg');
  const codeUI = document.getElementById('codeUI');
  const hint = document.getElementById('hint');

  const countdownWrap = document.getElementById('countdownWrap');
  const countdownEl = document.getElementById('countdown');

  const deniedText = document.getElementById('deniedText');
  const inputs = document.querySelectorAll('.code-row input');

  let countdownTimer = null;
  let secondsLeft = 15;
  let progressed = false;

  // Übergang: SERVER startet kurz vor Ende LOGIN
  let transitioned = false;
  const OVERLAP_SEC = 0.8;

  // Redirect-Guards
  let redirectArmed = false;
  let redirectDone = false;

  function show(el){ el.classList.add('on'); }
  function hide(el){ el.classList.remove('on'); }

  function clearInputs(){ inputs.forEach(i => i.value = ""); }

  function blurAll(){
    inputs.forEach(i => i.blur());
    if (document.activeElement && typeof document.activeElement.blur === "function") {
      document.activeElement.blur();
    }
  }

  function stopCountdown(){
    if (countdownTimer) clearInterval(countdownTimer);
    countdownTimer = null;
  }

  function setCountdown(n){
    countdownEl.textContent = String(n).padStart(2,'0');
  }

  function startCountdown(){
    stopCountdown();
    secondsLeft = 15;
    setCountdown(secondsLeft);

    countdownWrap.classList.add('on');
    countdownWrap.classList.add('countPulse');

    countdownTimer = setInterval(() => {
      secondsLeft--;
      setCountdown(Math.max(secondsLeft,0));
      if (secondsLeft <= 0){
        stopCountdown();
        proceedToDenied();
      }
    }, 1000);
  }

  function hideCountdown(){
    countdownWrap.classList.remove('on');
    countdownWrap.classList.remove('countPulse');
  }

  function proceedToCode(){
    hide(server);
    show(codeImg);

    codeUI.classList.add('on');
    hint.classList.add('on');

    // Countdown erst JETZT anzeigen
    startCountdown();

    setTimeout(() => inputs[0].focus(), 60);
  }

  function armRedirectAfterDeniedEnds(){
    if (redirectArmed) return;
    redirectArmed = true;

    const doRedirect = () => {
      if (redirectDone) return;
      redirectDone = true;
      setTimeout(() => {
        window.location.assign(CALENDLY_URL);
      }, 2000);
    };

    // Normal: onended
    denied.onended = doRedirect;

    // Robust: timeupdate (falls onended nicht feuert)
    const onTime = () => {
      if (!isFinite(denied.duration) || denied.duration <= 0) return;
      if (denied.currentTime >= denied.duration - 0.06) {
        denied.removeEventListener('timeupdate', onTime);
        doRedirect();
      }
    };
    denied.addEventListener('timeupdate', onTime);

    // Extra-Fallback: wenn duration da ist, setze Timer
    if (isFinite(denied.duration) && denied.duration > 0) {
      setTimeout(doRedirect, Math.ceil(denied.duration * 1000) + 400);
    } else {
      // Letzter Fallback: nach 12s (falls Metadaten fehlen)
      setTimeout(doRedirect, 12000);
    }
  }

  function proceedToDenied(){
    if (progressed) return;
    progressed = true;

    stopCountdown();
    hideCountdown();
    hint.classList.remove('on');

    // Tastatur weg + Felder leeren
    blurAll();
    clearInputs();

    // UI deaktivieren
    codeUI.classList.remove('on');

    // Bild weg, denied an
    hide(codeImg);
    show(denied);
    try { denied.play(); } catch(e) {}

    deniedText.classList.add('on');

    // Redirect zuverlässig vorbereiten
    // (onloadedmetadata kann später kommen – wir arming trotzdem sofort)
    armRedirectAfterDeniedEnds();
    denied.onloadedmetadata = armRedirectAfterDeniedEnds;
  }

  async function doTransitionToServer(){
    if (transitioned) return;
    transitioned = true;

    show(server);
    try { await server.play(); } catch(e) {}

    login.classList.add('dissolve');
    setTimeout(() => hide(login), 900);

    server.onended = () => proceedToCode();

    // Fallback: falls onended mal nicht feuert
    if (isFinite(server.duration) && server.duration > 0){
      setTimeout(() => {
        if (!progressed && !codeImg.classList.contains('on') && !denied.classList.contains('on')) {
          proceedToCode();
        }
      }, Math.ceil(server.duration * 1000) + 300);
    }
  }

  function attachSmoothTrigger(){
    transitioned = false;

    const onTime = () => {
      if (!isFinite(login.duration) || login.duration <= 0) return;
      const remaining = login.duration - login.currentTime;
      if (remaining <= OVERLAP_SEC){
        login.removeEventListener('timeupdate', onTime);
        doTransitionToServer();
      }
    };

    login.addEventListener('timeupdate', onTime);

    login.onended = () => {
      login.removeEventListener('timeupdate', onTime);
      doTransitionToServer();
    };
  }

  // Inputs: 1 Zeichen, auto-advance, Enter -> denied
  inputs.forEach((i, idx) => {
    i.addEventListener('input', () => {
      if (!i.value) return;
      i.value = i.value.slice(-1);
      if (inputs[idx+1]) inputs[idx+1].focus();
    });

    i.addEventListener('keydown', (e) => {
      if (e.key === "Enter"){
        e.preventDefault();
        proceedToDenied();
      }
    });
  });

  // ===== AUTOSTART (stumm) =====
  function resetAll(){
    progressed = false;
    transitioned = false;
    redirectArmed = false;
    redirectDone = false;

    hide(server); hide(denied); hide(codeImg);
    codeUI.classList.remove('on');
    hint.classList.remove('on');
    deniedText.classList.remove('on');

    stopCountdown();
    hideCountdown();
    setCountdown(15);

    clearInputs();
    blurAll();

    [login, server, denied].forEach(v => {
      try { v.pause(); v.currentTime = 0; } catch(e) {}
    });
    login.classList.remove('dissolve');
  }

  (async function start(){
    resetAll();

    show(login);
    try { await login.play(); } catch(e) {}

    attachSmoothTrigger();
  })();
</script>

</body>
</html>
